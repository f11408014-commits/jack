<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¶å¯å¤¢éš¨æ©Ÿå°æˆ°æŒ‘æˆ° - æŠ€èƒ½å¼·åŒ–ç‰ˆ</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #2563eb 0%, #1e3a8a 100%); /* è—è‰²ç³»ä¸»è¦–è¦º */
        }
        .pokemon-card {
            border: 4px solid #facc15; /* é»ƒè‰²é‚Šæ¡† */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            transition: transform 0.2s;
            background-color: #f3f4f6;
        }
        .hp-bar {
            transition: width 0.5s ease-in-out, background-color 0.5s;
        }
        .log-entry {
            padding: 4px 8px;
            margin-bottom: 4px;
            border-radius: 6px;
            font-weight: 500;
        }
        /* æˆ°é¬¥è¨˜éŒ„é¡è‰² */
        .log-player { background-color: rgba(167, 243, 208, 0.9); } /* ç©å®¶è¡Œå‹• (æ·ºç¶ ) */
        .log-opponent { background-color: rgba(254, 202, 202, 0.9); } /* å°æ‰‹è¡Œå‹• (æ·ºç´…) */
        .log-info { background-color: rgba(199, 210, 254, 0.9); } /* è³‡è¨Š (æ·ºè—) */

        .move-button {
            font-weight: 800;
            padding: 12px 16px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            transition: all 0.15s;
        }
        .move-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
        }
        .move-button:disabled {
            cursor: not-allowed;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- ä¸»è¦éŠæˆ²ä»‹é¢ -->
    <div id="game-container" class="w-full max-w-3xl bg-white p-6 rounded-3xl shadow-2xl border-8 border-yellow-400">
        <h1 class="text-3xl font-black text-center text-blue-800 mb-6 tracking-wider">å¯¶å¯å¤¢éš¨æ©Ÿå°æˆ°ï¼æŠ€èƒ½å¤§å‡ç´šï¼</h1>

        <!-- æˆ°é¬¥å€åŸŸ -->
        <div class="space-y-8">
            <!-- å°æ‰‹å¯¶å¯å¤¢ -->
            <div class="pokemon-card p-4 rounded-xl shadow-lg flex items-start space-x-4">
                <span id="opponent-icon" class="text-5xl">?</span>
                <div class="flex-grow">
                    <div id="opponent-name" class="text-xl font-bold text-gray-700">å°æ‰‹å¯¶å¯å¤¢</div>
                    <!-- å°æ‰‹ HP æ¢ -->
                    <div class="mt-1 w-full h-3 bg-gray-300 rounded-full overflow-hidden">
                        <div id="opponent-hp-bar" class="hp-bar h-full bg-red-500" style="width: 100%;"></div>
                    </div>
                    <div id="opponent-hp-text" class="text-sm font-mono text-gray-700 mt-1">HP: 0/0</div>
                </div>
            </div>

            <!-- ç©å®¶å¯¶å¯å¤¢ -->
            <div class="pokemon-card p-4 rounded-xl shadow-lg flex items-end justify-end space-x-4">
                <div class="flex-grow text-right">
                    <div id="player-name" class="text-xl font-bold text-gray-700">æ‚¨çš„å¯¶å¯å¤¢</div>
                    <!-- ç©å®¶ HP æ¢ -->
                    <div class="mt-1 w-full h-3 bg-gray-300 rounded-full overflow-hidden">
                        <div id="player-hp-bar" class="hp-bar h-full bg-green-500" style="width: 100%;"></div>
                    </div>
                    <div id="player-hp-text" class="text-sm font-mono text-gray-700 mt-1">HP: 0/0</div>
                </div>
                <span id="player-icon" class="text-5xl">?</span>
            </div>
        </div>

        <!-- æˆ°é¬¥ç´€éŒ„ -->
        <div class="mt-6 bg-gray-800 p-4 rounded-xl h-40 overflow-y-auto border border-gray-700">
            <h2 class="text-lg font-semibold text-yellow-300 mb-2 border-b border-gray-700">æˆ°é¬¥ç´€éŒ„</h2>
            <div id="battle-log" class="text-sm text-gray-300"></div>
        </div>

        <!-- æ‹›å¼æŒ‰éˆ•å€ (2x2) -->
        <div id="move-buttons" class="mt-6 grid grid-cols-2 gap-4">
            <!-- 4 å€‹æ‹›å¼æŒ‰éˆ•å°‡ç”± JavaScript æ¸²æŸ“ -->
        </div>

    </div>

    <!-- éŠæˆ²çµæœ Modal -->
    <div id="result-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center hidden z-50">
        <div class="bg-white p-10 rounded-xl shadow-2xl text-center border-4 border-yellow-500 w-full max-w-md">
            <h2 id="result-title" class="text-4xl font-extrabold mb-4"></h2>
            <p id="result-message" class="text-xl text-gray-800 mb-6"></p>
            
            <!-- æŠ˜æ‰£ç¢¼å€å¡Š (åƒ…å‹åˆ©æ™‚é¡¯ç¤º) -->
            <div id="discount-code-area" class="hidden mb-6 p-4 bg-yellow-100 rounded-lg border border-green-500">
                <p class="text-sm text-gray-700 mb-2">æ­å–œï¼é€™æ˜¯æ‚¨ç²å¾—çš„å‹åˆ©çå‹µï¼š</p>
                <code id="discount-code" class="text-2xl font-mono text-red-600 select-all p-3 bg-white rounded block border-dashed border-2 border-red-300"></code>
            </div>

            <button onclick="window.location.reload()" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition duration-150 ease-in-out">
                é‡æ–°æŒ‘æˆ°
            </button>
        </div>
    </div>

    <script>
        // --- å¯¶å¯å¤¢å®šç¾©æ±  (æ¯å€‹å¯¶å¯å¤¢æœ‰ 4 å€‹æ‹›å¼) ---
        const pokemonPool = [
            { 
                name: 'ç«ç„°èœ¥èœ´', maxHP: 100, element: 'fire', icon: 'ğŸ”¥ğŸ¦', 
                moves: [
                    { name: 'ç«èŠ±', damage: 10, element: 'fire' },
                    { name: 'çƒˆç„°è¡æ’', damage: 15, element: 'fire' },
                    { name: 'å™´å°„ç«ç„°', damage: 18, element: 'fire' },
                    { name: 'ç«ä¹‹èª“ç´„', damage: 25, element: 'fire' },
                ],
                color: 'bg-red-500 hover:bg-red-600'
            },
            { 
                name: 'å¯’å†°å·¨é¾', maxHP: 120, element: 'ice', icon: 'ğŸ²â„ï¸', 
                moves: [
                    { name: 'å†°éŒ', damage: 12, element: 'ice' },
                    { name: 'é›ªå´©', damage: 16, element: 'ice' },
                    { name: 'æ€¥å‡å…‰ç·š', damage: 20, element: 'ice' },
                    { name: 'æš´é¢¨é›ª', damage: 24, element: 'ice' },
                ],
                color: 'bg-blue-500 hover:bg-blue-600'
            },
            { 
                name: 'å¤§åœ°å®ˆè¡›', maxHP: 110, element: 'ground', icon: 'ğŸ—¿ğŸŒ³', 
                moves: [
                    { name: 'é£›æ²™èµ°çŸ³', damage: 13, element: 'ground' },
                    { name: 'å²©çŸ³çˆ†æ“Š', damage: 17, element: 'ground' },
                    { name: 'åœ°éœ‡', damage: 22, element: 'ground' },
                    { name: 'å¤§åœ°ä¹‹åŠ›', damage: 26, element: 'ground' },
                ],
                color: 'bg-yellow-600 hover:bg-yellow-700'
            },
            { 
                name: 'ç–¾é¢¨é³¥äºº', maxHP: 90, element: 'flying', icon: 'ğŸ’¨ğŸ¦…', 
                moves: [
                    { name: 'ç–¾é¢¨', damage: 11, element: 'flying' },
                    { name: 'ç©ºæ°£æ–¬', damage: 14, element: 'flying' },
                    { name: 'æš´é¢¨', damage: 19, element: 'flying' },
                    { name: 'ç¥é³¥çŒ›æ“Š', damage: 23, element: 'flying' },
                ],
                color: 'bg-cyan-500 hover:bg-cyan-600'
            },
            { 
                name: 'ç¥ç§˜æ°´æ¯', maxHP: 105, element: 'water', icon: 'ğŸ’§ğŸ™', 
                moves: [
                    { name: 'æ°´æ§', damage: 10, element: 'water' },
                    { name: 'æ°´æµå™´å°„', damage: 14, element: 'water' },
                    { name: 'è¡æµª', damage: 17, element: 'water' },
                    { name: 'æ¿€æµ', damage: 25, element: 'water' },
                ],
                color: 'bg-indigo-500 hover:bg-indigo-600'
            },
            { 
                name: 'é›·é›»ç¸', maxHP: 95, element: 'electric', icon: 'âš¡ï¸ğŸ¦', 
                moves: [
                    { name: 'é›»æ“Š', damage: 14, element: 'electric' },
                    { name: 'é–ƒé›»', damage: 16, element: 'electric' },
                    { name: 'åè¬ä¼ç‰¹', damage: 21, element: 'electric' },
                    { name: 'ä¼ç‰¹æ”»æ“Š', damage: 27, element: 'electric' },
                ],
                color: 'bg-amber-500 hover:bg-amber-600'
            },
        ];

        // --- å±¬æ€§ç›¸å‰‹è¡¨ (Super Effective: x1.5, Not Effective: x0.5) ---
        const typeMatchups = {
            fire: { superEffective: ['ice', 'ground'], notEffective: ['water'] },
            ice: { superEffective: ['flying'], notEffective: ['fire'] },
            ground: { superEffective: ['electric', 'fire'], notEffective: ['flying', 'water'] },
            flying: { superEffective: ['ground'], notEffective: ['ice', 'electric'] },
            water: { superEffective: ['fire', 'ground'], notEffective: ['electric'] },
            electric: { superEffective: ['water', 'flying'], notEffective: ['ground'] },
        };

        // --- éŠæˆ²ç‹€æ…‹è®Šæ•¸ ---
        let player = {};
        let opponent = {};
        let isPlayerTurn = true;
        let isGameOver = false;

        // --- DOM å…ƒç´ å¿«å– ---
        const $playerHPText = document.getElementById('player-hp-text');
        const $playerHPBar = document.getElementById('player-hp-bar');
        const $opponentHPText = document.getElementById('opponent-hp-text');
        const $opponentHPBar = document.getElementById('opponent-hp-bar');
        const $battleLog = document.getElementById('battle-log');
        const $moveButtons = document.getElementById('move-buttons');
        const $resultModal = document.getElementById('result-modal');
        const $resultTitle = document.getElementById('result-title');
        const $resultMessage = document.getElementById('result-message');
        const $discountCodeArea = document.getElementById('discount-code-area');
        const $playerName = document.getElementById('player-name');
        const $playerIcon = document.getElementById('player-icon');
        const $opponentName = document.getElementById('opponent-name');
        const $opponentIcon = document.getElementById('opponent-icon');
        const $discountCode = document.getElementById('discount-code');


        /** ç´€éŒ„æˆ°é¬¥è¨Šæ¯ */
        function logMessage(message, type) {
            const entry = document.createElement('div');
            // æ ¹æ“šé¡å‹æ·»åŠ ä¸åŒçš„æ¨£å¼
            entry.className = `log-entry text-gray-900 ${type === 'player' ? 'log-player' : type === 'opponent' ? 'log-opponent' : 'log-info'} text-sm`;
            entry.innerHTML = message;
            $battleLog.prepend(entry); // å°‡æœ€æ–°è¨Šæ¯æ”¾åœ¨æœ€ä¸Šé¢
        }

        /** æ›´æ–° HP é¡¯ç¤º */
        function updateHealthDisplay() {
            // è¨ˆç®—ç™¾åˆ†æ¯”
            const playerPercent = (player.currentHP / player.maxHP) * 100;
            const opponentPercent = (opponent.currentHP / opponent.maxHP) * 100;

            // æ›´æ–°ç©å®¶ HP
            $playerHPText.textContent = `HP: ${Math.max(0, player.currentHP)}/${player.maxHP}`;
            $playerHPBar.style.width = `${Math.max(0, playerPercent)}%`;
            // æ ¹æ“š HP ç™¾åˆ†æ¯”æ”¹è®Šé¡è‰² (ç¶ ->é»ƒ->ç´…)
            $playerHPBar.style.backgroundColor = playerPercent > 50 ? '#10b981' : playerPercent > 20 ? '#facc15' : '#ef4444';

            // æ›´æ–°å°æ‰‹ HP
            $opponentHPText.textContent = `HP: ${Math.max(0, opponent.currentHP)}/${opponent.maxHP}`;
            $opponentHPBar.style.width = `${Math.max(0, opponentPercent)}%`;
            $opponentHPBar.style.backgroundColor = opponentPercent > 50 ? '#10b981' : opponentPercent > 20 ? '#facc15' : '#ef4444';
        }

        /** è¨ˆç®—å‚·å®³ (ä½¿ç”¨å±¬æ€§ç›¸å‰‹è¡¨) */
        function calculateDamage(attacker, defender, move) {
            let baseDamage = move.damage;
            let multiplier = 1.0;
            let effectivenessMessage = "";

            const matchups = typeMatchups[move.element];

            if (matchups) {
                if (matchups.superEffective.includes(defender.element)) {
                    multiplier = 1.5;
                    effectivenessMessage = `<span class="text-red-600 font-bold">å±¬æ€§æœ‰åˆ©ï¼æ•ˆæœçµ•ä½³ï¼</span>`;
                } else if (matchups.notEffective.includes(defender.element)) {
                    multiplier = 0.5;
                    effectivenessMessage = `<span class="text-blue-600 font-bold">å±¬æ€§ä¸åˆ©... æ•ˆæœä¸å¥½ã€‚</span>`;
                }
            }
            
            // å°‘é‡éš¨æ©Ÿæ€§ (90% åˆ° 110%)ï¼Œå¢åŠ æˆ°é¬¥ä¸ç¢ºå®šæ€§
            const randomFactor = 0.9 + Math.random() * 0.2; 
            
            let finalDamage = Math.floor(baseDamage * multiplier * randomFactor);
            
            if (effectivenessMessage) {
                 logMessage(effectivenessMessage, 'info');
            }

            return Math.max(1, finalDamage); // ç¢ºä¿å‚·å®³è‡³å°‘ç‚º 1
        }

        /** ç©å®¶å›åˆè™•ç† */
        window.handlePlayerMove = function(moveIndex) {
            if (isGameOver || !isPlayerTurn) return;

            const move = player.moves[moveIndex];
            logMessage(`${player.icon} ${player.name} å° ${opponent.name} ä½¿ç”¨äº† [${move.name}]ï¼`, 'player');

            // 1. è¨ˆç®—ä¸¦é€ æˆå‚·å®³
            const damage = calculateDamage(player, opponent, move);
            opponent.currentHP -= damage;
            logMessage(`${opponent.icon} ${opponent.name} å—åˆ° <span style="color:#ef4444; font-weight:bold;">${damage}</span> é»å‚·å®³ã€‚`, 'player');

            // 2. æ›´æ–° UI
            updateHealthDisplay();
            disableMoves(true); // ç¦ç”¨æŒ‰éˆ•ç›´åˆ°å°æ‰‹è¡Œå‹•çµæŸ

            // 3. æª¢æŸ¥å‹åˆ©æ¢ä»¶
            if (checkWinCondition()) return;

            // 4. è½‰æ›ç‚ºå°æ‰‹å›åˆ
            isPlayerTurn = false;
            setTimeout(opponentTurn, 2000); // å»¶é² 2 ç§’åŸ·è¡Œå°æ‰‹å›åˆ
        }

        /** å°æ‰‹å›åˆè™•ç† */
        function opponentTurn() {
            if (isGameOver) return;

            // 1. å°æ‰‹éš¨æ©Ÿé¸æ“‡æ‹›å¼
            const moveIndex = Math.floor(Math.random() * opponent.moves.length);
            const move = opponent.moves[moveIndex];
            logMessage(`${opponent.icon} ${opponent.name} å°æ‚¨ä½¿ç”¨äº† [${move.name}]ï¼`, 'opponent');

            // 2. è¨ˆç®—ä¸¦é€ æˆå‚·å®³
            const damage = calculateDamage(opponent, player, move);
            player.currentHP -= damage;
            logMessage(`${player.icon} ${player.name} å—åˆ° <span style="color:#ef4444; font-weight:bold;">${damage}</span> é»å‚·å®³ã€‚`, 'opponent');

            // 3. æ›´æ–° UI
            updateHealthDisplay();

            // 4. æª¢æŸ¥å¤±æ•—æ¢ä»¶
            if (checkWinCondition()) return;

            // 5. è½‰æ›å›ç©å®¶å›åˆ
            isPlayerTurn = true;
            disableMoves(false); // å•Ÿç”¨æŒ‰éˆ•
            logMessage("ç¾åœ¨æ˜¯æ‚¨çš„å›åˆï¼è«‹é¸æ“‡æ‹›å¼ã€‚", 'info');
        }

        /** æª¢æŸ¥å‹åˆ©æˆ–å¤±æ•—æ¢ä»¶ */
        function checkWinCondition() {
            if (isGameOver) return true;

            if (opponent.currentHP <= 0) {
                isGameOver = true;
                showResult(true);
                return true;
            } else if (player.currentHP <= 0) {
                isGameOver = true;
                showResult(false);
                return true;
            }
            return false;
        }

        /** ç¦ç”¨/å•Ÿç”¨æ‹›å¼æŒ‰éˆ• */
        function disableMoves(disabled) {
            document.querySelectorAll('#move-buttons button').forEach(btn => {
                btn.disabled = disabled;
                btn.classList.toggle('opacity-50', disabled);
                btn.classList.toggle('cursor-not-allowed', disabled);
            });
        }

        /** é¡¯ç¤ºçµæœ Modal */
        function showResult(isWin) {
            $resultModal.classList.remove('hidden');
            disableMoves(true); 

            if (isWin) {
                $resultTitle.textContent = "æˆ°é¬¥å‹åˆ©ï¼ç²å¾—çå‹µï¼";
                $resultTitle.classList.remove('text-red-600');
                $resultTitle.classList.add('text-green-600');
                $resultMessage.textContent = `æ­å–œæ‚¨æˆåŠŸæ“Šæ•—å°æ‰‹ ${opponent.name}ï¼æ‚¨æ˜¯çœŸæ­£çš„å¯¶å¯å¤¢å¤§å¸«ï¼`;
                $discountCodeArea.classList.remove('hidden');
                // å‹•æ…‹ç”ŸæˆæŠ˜æ‰£ç¢¼ (5 ä½éš¨æ©Ÿæ•¸å­—)
                $discountCode.textContent = `WINNER-${Math.floor(Math.random() * 90000) + 10000}`;
            } else {
                $resultTitle.textContent = "æˆ°é¬¥å¤±æ•—...";
                $resultTitle.classList.remove('text-green-600');
                $resultTitle.classList.add('text-red-600');
                $resultMessage.textContent = `æ‚¨çš„ ${player.name} å·²å¤±å»æˆ°é¬¥èƒ½åŠ›ï¼Œè«‹å†åŠ æ²¹ï¼ä¸‹æ¬¡ä¸€å®šèƒ½æˆåŠŸï¼`;
                $discountCodeArea.classList.add('hidden');
            }
            logMessage(isWin ? "éŠæˆ²çµæŸï¼šå‹åˆ©ï¼ŒæŠ˜æ‰£ç¢¼å·²é¡¯ç¤ºã€‚" : "éŠæˆ²çµæŸï¼šå¤±æ•—ï¼Œé¼“å‹µè¨Šæ¯å·²é¡¯ç¤ºã€‚", 'info');
        }

        /** æ¸²æŸ“æ‹›å¼æŒ‰éˆ• */
        function renderMoveButtons() {
            // æ‹›å¼æŒ‰éˆ•ä½ˆå±€ç‚º 2x2
            $moveButtons.innerHTML = player.moves.map((move, index) => `
                <button 
                    onclick="handlePlayerMove(${index})" 
                    class="move-button text-white ${player.color} text-lg"
                >
                    ${move.name} 
                    <span class="block text-sm font-normal"> (å¨åŠ›: ${move.damage} / å±¬æ€§: ${move.element})</span>
                </button>
            `).join('');
        }

        /** éš¨æ©ŸæŠ½å–å¯¶å¯å¤¢ä¸¦åˆå§‹åŒ–ç‹€æ…‹ */
        function initializePokemon() {
            // éš¨æ©ŸæŠ½å–ç©å®¶å¯¶å¯å¤¢
            const playerIndex = Math.floor(Math.random() * pokemonPool.length);
            const playerTemplate = pokemonPool[playerIndex];
            player = { ...playerTemplate, currentHP: playerTemplate.maxHP };

            // éš¨æ©ŸæŠ½å–å°æ‰‹å¯¶å¯å¤¢ (ç¢ºä¿ä¸èˆ‡ç©å®¶ç›¸åŒ)
            let opponentIndex;
            do {
                opponentIndex = Math.floor(Math.random() * pokemonPool.length);
            } while (opponentIndex === playerIndex);
            
            const opponentTemplate = pokemonPool[opponentIndex];
            opponent = { ...opponentTemplate, currentHP: opponentTemplate.maxHP };
        }

        /** éŠæˆ²åˆå§‹åŒ– */
        function startGame() {
            initializePokemon(); // éš¨æ©Ÿé¸æ“‡å¯¶å¯å¤¢

            // æ›´æ–°ä»‹é¢ä¸Šçš„å¯¶å¯å¤¢è³‡è¨Š
            $playerName.textContent = `${player.name} (${player.element})`;
            $playerIcon.textContent = player.icon;
            $opponentName.textContent = `${opponent.name} (${opponent.element})`;
            $opponentIcon.textContent = opponent.icon;
            
            logMessage(`å°æ‰‹ ${opponent.icon} ${opponent.name} (${opponent.element}ç³») å‡ºç¾äº†ï¼`, 'info');
            logMessage(`æ‚¨çš„ ${player.icon} ${player.name} (${player.element}ç³») åƒæˆ°ï¼æˆ°é¬¥é–‹å§‹ã€‚`, 'info');
            logMessage("å±¬æ€§ç›¸å‰‹æç¤ºï¼šç«å‰‹å†°/åœ°ï¼›å†°å‰‹é£›ï¼›åœ°å‰‹é›»/ç«ï¼›é£›å‰‹åœ°ï¼›æ°´å‰‹ç«/åœ°ï¼›é›»å‰‹æ°´/é£›ã€‚", 'info');
            
            renderMoveButtons();
            updateHealthDisplay();
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œå•Ÿå‹•éŠæˆ²
        window.onload = startGame;

    </script>
</body>
</html>
